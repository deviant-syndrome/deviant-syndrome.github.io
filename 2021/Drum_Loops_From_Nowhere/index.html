<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Drum Loops From Nowhere</title>
  <meta name="description" content="Why Should I Do What Everyone Does

What I currently miss the most with my minimalist no-budget music production setup, definitely would be some organic, pounding and swinging battery. I do not really have much interest in using loops or pre-processed sample libs (tHat CUTt trhU Ze MiX!), because as Chris Randall once said, you have no time to screw around with somebody else’s music if you’re really want to make your own. Truly, with the standards I impose on my self, simply downloading a copy of MT PowerDrums, would be a statement of artistic and engineer impotence.
So far, I got some applicable results in “personalised” percussive sounds, by exploring the following approaches:

  Basic subtractive and FM synthesis. Unless, you are a sound-design and electrical-engineering expert, that is your usual “blip-blop” type of electro-drum sounds.
  Found objects. This is always fun. Just put your smartphone on record every time you take out the trash,
  Physical modeling. Good for membrane percussion, quickly gets complicated for cymbals, because of their complex “clustered” nature of sound.


So here is a small demo I built around a manipulated drum loop which was generate. On the course of this post I’ll try to explain how you can create one yourself.


	



  Download Zip
  Sample WAVs Generated by NN


">
  <meta name="author" content="Deviant Syndrome">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Drum Loops From Nowhere">
  <meta name="twitter:description" content="Why Should I Do What Everyone Does

What I currently miss the most with my minimalist no-budget music production setup, definitely would be some organic, pounding and swinging battery. I do not really have much interest in using loops or pre-processed sample libs (tHat CUTt trhU Ze MiX!), because as Chris Randall once said, you have no time to screw around with somebody else’s music if you’re really want to make your own. Truly, with the standards I impose on my self, simply downloading a copy of MT PowerDrums, would be a statement of artistic and engineer impotence.
So far, I got some applicable results in “personalised” percussive sounds, by exploring the following approaches:

  Basic subtractive and FM synthesis. Unless, you are a sound-design and electrical-engineering expert, that is your usual “blip-blop” type of electro-drum sounds.
  Found objects. This is always fun. Just put your smartphone on record every time you take out the trash,
  Physical modeling. Good for membrane percussion, quickly gets complicated for cymbals, because of their complex “clustered” nature of sound.


So here is a small demo I built around a manipulated drum loop which was generate. On the course of this post I’ll try to explain how you can create one yourself.


	



  Download Zip
  Sample WAVs Generated by NN


">
  
  <meta name="twitter:image" content="/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Drum Loops From Nowhere">
  <meta property="og:description" content="Why Should I Do What Everyone Does

What I currently miss the most with my minimalist no-budget music production setup, definitely would be some organic, pounding and swinging battery. I do not really have much interest in using loops or pre-processed sample libs (tHat CUTt trhU Ze MiX!), because as Chris Randall once said, you have no time to screw around with somebody else’s music if you’re really want to make your own. Truly, with the standards I impose on my self, simply downloading a copy of MT PowerDrums, would be a statement of artistic and engineer impotence.
So far, I got some applicable results in “personalised” percussive sounds, by exploring the following approaches:

  Basic subtractive and FM synthesis. Unless, you are a sound-design and electrical-engineering expert, that is your usual “blip-blop” type of electro-drum sounds.
  Found objects. This is always fun. Just put your smartphone on record every time you take out the trash,
  Physical modeling. Good for membrane percussion, quickly gets complicated for cymbals, because of their complex “clustered” nature of sound.


So here is a small demo I built around a manipulated drum loop which was generate. On the course of this post I’ll try to explain how you can create one yourself.


	



  Download Zip
  Sample WAVs Generated by NN


">
  <meta property="og:image" content="/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="stylesheet" href="/css/main.css?1661589250310431000">
  <link rel="canonical" href="/2021/Drum_Loops_From_Nowhere/">
  <link rel="alternate" type="application/rss+xml" title="Deviant Syndrome" href="/feed.xml">
<script>
window.MathJax = {
  tex: {
      packages: ['base', 'ams', 'noerrors', 'noundefined'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: false
  },
  loader: {
    load: ['[tex]/noerrors']
  }
};

  window.MathJax = {
  startup: {
    ready: () => {
      console.log('MathJax is loaded, but not yet initialized');
      MathJax.startup.defaultReady();
      console.log('MathJax is initialized, and the initial typeset is queued');
    }
  }
};
</script>
<style>
  @font-face {
    font-family: 'alphaTab';
     src: url('/js/alphaTab/Font/Bravura.eot');
     src: url('/js/alphaTab/Font/Bravura.eot') format('embedded-opentype')
          , url('/js/alphaTab/Font/Bravura.woff') format('woff')
          , url('/js/alphaTab/Font/Bravura.etf') format('opentype')
          , url('/js/alphaTab/Font/Bravura.svg') format('svg');
     font-weight: normal;
     font-style: normal;
}
</style>
<link rel="stylesheet" type="text/css" href="/assets/notation.css"> 
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
<script src="/js/mathjax/tex-chtml.js" id="MathJax-script" async></script>

<script src="/js/alphaTab/AlphaTab.js" async></script>
<script src="/js/audiojs/audio.min.js"></script>
<link  href="/js/nanogallery2/css/nanogallery2.min.css" rel="stylesheet" type="text/css">
<script  type="text/javascript" src="/js/nanogallery2/jquery.nanogallery2.min.js"></script>
<link rel="stylesheet" href="/css/main.css?1661589250310431000">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Deviant Syndrome">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Deviant Syndrome</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">coding, multimedia, gamedev, engineering</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Deviant Syndrome blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

              <!-- Bandcamp -->
              <li class="navigation__item">
                <a href="http://hexensoldat.bandcamp.com" title="@Deviant Syndrome on Bandcamp"
                   target="_blank">
                  <i class="icon icon-social-bandcamp"></i>
                  <span class="label">Bandcamp</span>
                </a>
              </li>

              

            

            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/deviant-syndrome" title="deviant-syndrome on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2021-06-14 12:36" class="post-meta__date date">14 Jun 2021</time>
      
      &#8226; <span class="post-meta__tags">on <a href="/tags/#wavegan">wavegan</a> <a href="/tags/#software">software</a> <a href="/tags/#docker">docker</a> <a href="/tags/#dsp">dsp</a> </span>
      
    </div>
    <h1 class="post-title">Drum Loops From Nowhere</h1>
  </header>

  <section class="post">
    <h4 id="why-should-i-do-what-everyone-does">Why Should I Do What Everyone Does</h4>

<p>What I currently miss the most with my minimalist no-budget music production setup, definitely would be some organic, pounding and swinging battery. I do not really have much interest in using loops or pre-processed sample libs (tHat CUTt trhU Ze MiX!), because as Chris Randall once said, you have no time to screw around with somebody else’s music if you’re really want to make your own. Truly, with the standards I impose on my self, simply downloading a copy of MT PowerDrums, would be a statement of artistic and engineer impotence.
So far, I got some applicable results in “personalised” percussive sounds, by exploring the following approaches:</p>
<ul>
  <li>Basic subtractive and FM synthesis. Unless, you are a sound-design and electrical-engineering expert, that is your usual “blip-blop” type of electro-drum sounds.</li>
  <li>Found objects. This is always fun. Just put your smartphone on record every time you take out the trash,</li>
  <li>Physical modeling. Good for membrane percussion, quickly gets complicated for cymbals, because of their complex “clustered” nature of sound.</li>
</ul>

<p>So here is a small demo I built around a manipulated drum loop which was generate. On the course of this post I’ll try to explain how you can create one yourself.</p>

<div class="audio-container" style="margin-bottom: 32px;">
	<audio src="/mp3/2021/nn_drums_demo.mp3" preload="auto"></audio>
</div>

<div class="downloadBox" onclick="window.location='/assets/nn_gen_drum_phrases.zip'; return false;">
  Download Zip<br />
  <p style="font-size: small; margin-top: 2px; margin-bottom: 2px;">Sample WAVs Generated by NN</p>
</div>

<!-- readmore -->

<h4 id="neural-networks-for-sound-generation">Neural Networks for Sound Generation</h4>

<p>What I have not tried yet, would be NN-generated sound for drum loops and samples. First, and foremost (for a math-n00b like me), it requires
 sufficiently less
 mathematical knowledge
. Neural
 networks consist almost entirely of linear algebra. No third-grade partial derivative equation systems, which wonderful world of physical modeling is so full of. Second, if current physical modeling paradigm concentrates of modeling a sound of a single hit (excitation of membrane or string pluck), generative neural networks, being completely agnostic of the physical nature of signals they are working with, could in fact, produce a non-deterministic rhythmic sequence of percussion hits (or rather, transients), if only we would train the model exclusively on soloed drum parts, of course. Which is the exact thing we’re gonna do!</p>

<p>This way, a trained NN model could become an endless source of free and unique sounds, phrases and rhythmic textures . Well, maybe not completely free, as it still considered a but of a legal “gray area”, whenever you really own something to the copyright owners of the material you’ve trained you neural network on. Some GAN software explicitly states in it’s license, that the code itself and the models it produces are free for non-commercial use only.</p>

<p>The reason, it excites me so much, is that I personally feel, that this kind of approach is a bit underexplored area of artistic expression using machine-learning. I draw this conclusion from the fact, that the most advanced projects in this segment, such as Jukebox AI, seem to concentrate on producing a flow of “consumption ready” generated “music”. I netherless, admit the stellar results in facilitating that, achieved by community of developers and users of that software. My goals are much less ambitious.</p>

<h4 id="generative-adversarial-networks-in-one-passage-under-a-minute">Generative Adversarial Networks in One Passage Under a Minute</h4>

<p>The basics of machine learning is finding the coefficients (weights) for nodes in a traversable structure, so when calculating the output, it
 matches the label apriori given to a sample of input data. The way nodes are connected loosely represent, hence the name. To describe a wide
  area of machine learning applications on a very high-level, a term “labeling” could be used. So, NN model that got its node weights determined by being “trained” on million of kitten and puppy photos, could then determine (“label”) if an arbitrary input photo is a photo of a cub or a kitten with a decent level of accuracy.
In case of generating content task, Two neural networks, the generative one and discriminative one. When learning, generative network acquires a latent space of, from which it draws samples to produce random signals. Those random signals then sent to discriminative network, which is trained to determine if those have the same characteristics as initial data. For sake of that, both networks are trained on the same dataset. So, by playing this , this pair are capable of fluently generating new content that would “fit” the initial data traits.</p>

<h4 id="using-wavegan-and-aws-cloud-computing-solution-to-facilitate-the-experiment">Using WaveGAN and AWS Cloud Computing Solution to Facilitate the Experiment</h4>

<p>For our attempt at NN-generated percussion we will be using <a href="https://github.com/chrisdonahue/wavegan">WaveGAN</a> - an implementation of GAN which samples audio at high-temporal resolutions, thus, being to capture spectral structures across a range of timescales, when learning. It is implemented in Python using <a href="https://www.tensorflow.org/">Tensorflow 1.2</a> framework.</p>

<p>So, how do we train our WaveGAN model on those audio-files? 
Well, unless you are fond of computer games, issued after Y2K, or (unlike me) a real scientist with access to your university’s mainframe, you probably do not have a powerful enough GPU hardware to train a GAN in a comfort of your dungeon. As a cloud based solution that provides GPU-based computing I chose AWS, for the following initial reaons:</p>
<ul>
  <li>Uncanny familiarity. If you have a goatie and know what “MVC” is, I have bad news for ya.</li>
  <li>Religious concerns (there is no way I’m touching Azure)</li>
  <li>Advertised dedicated machine learning solution (emphasis on “advertised”)</li>
  <li>Advertised “Free-Tier” for newly created accounts (double emphasis on “advertised”)</li>
</ul>

<h4 id="sagemaker-high-level-overview-and-initial-experiment-plan">SageMaker. High Level Overview and Initial Experiment Plan</h4>

<p>Let’s take a high level overview of how SageMaker works. 
So, skimmed from all the buzzwords and marketing, it is a number of core Amazon AWS offerings (virtual machines and cloud storage), all duck-taped toghether around the topic of machine learning. Basically, it automates the following flow, that you would otherwise do manually when traning the neural network in the clooud:</p>
<ol>
  <li>Provisioning and starting an instance</li>
  <li>Copying the program and train data to the instance</li>
  <li>Start the program in the training mode</li>
  <li>Collect metrics</li>
  <li>Stop training</li>
  <li>Copy the model from the instance to AWS S3 cloud storage (“checkpoint”)</li>
  <li>Shut down the instance</li>
</ol>

<p>// Illustration, training jobs</p>

<p>To be fair, it actually does more than that. For example, it supports training parallelization (it can partition by data, or by.). Sounds fun, but unless you’re using something readymade from SageMaker’s marketplace , you’ll have to do quite unobvious modifications to you code, to make it work.</p>

<p>Also, you’ll get something called “SageMaker Studio”, a small dedicated server, fronted by Jupyter Python Notebook, which aslo has a permanent SSD storage and all the core AWS utils as well, as the essential data-science Python libs like SciPy pre-installed. To execute the notebook’s cell, you’ll need to select a runtime and a kernel, which will start a remote cloud instance and connect to your notebook to a Python kernel . You can choose between TensorFlow and PyTorch being the backbone of your computations.
Those notebooks, would be, actually, useful, when getting the output of your trained network. because SageMaker’s solutions for hosting a model seem a bit overcomplicated to me, as they have a flow and setup completely separate from the “training” phase.</p>

<h4 id="the-process-expectations-vs-reality">The Process. Expectations vs Reality</h4>

<p>Before even creating my personal Amazon account, I had the following theoretical steps in mind: 
Steps:</p>
<ol>
  <li>Create an Amazon Account, they offer something like one month of free computation using their SageMaker platform.</li>
  <li>Use WaveGAN (probably not the best choice for the task, but seems easy enough to set up and go).</li>
  <li>Get some raw material. Demo loops of drum libraries should be a good enough bit for the first try</li>
  <li>Upload them to S3 somehow</li>
  <li>Start learning</li>
  <li>Monitor the training. Use log-based monitoring</li>
  <li>Start a notebook instance</li>
  <li>Load the trained model</li>
  <li>Generate sounds</li>
</ol>

<p>So, how did it hold up against my initial expectations? Well, OK-ish, I’d say.</p>

<p>First and foremost, AWS Console Web UI is nothing but a freaking labyrinth. So, I had to bookmark a bunch of pages, to whom I kept constantly coming back to lookup and refrence things along the way.</p>

<ul>
  <li>
    <p><a href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc&amp;awsf.Free%20Tier%20Types=*all&amp;awsf.Free%20Tier%20Categories=*all">AWS free tier guide</a></p>
  </li>
  <li>
    <p><a href="https://sagemaker.readthedocs.io/en/stable/overview.html#train-a-model-with-the-sagemaker-python-sdk">Custom learning script on a SageMaker instance</a></p>
  </li>
  <li>
    <p><a href="https://sagemaker-examples.readthedocs.io/en/latest/training/bring_your_own_container.html">Build and bring your own container</a></p>
  </li>
  <li>
    <p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_create-admin-group.html">AWS Admin credentials</a></p>
  </li>
  <li>
    <p><a href="https://aws.amazon.com/sagemaker/pricing/">SageMaker pricing, instance types and stuff</a></p>
  </li>
  <li>
    <p><a href="https://sagemaker.readthedocs.io/en/stable/frameworks/tensorflow/using_tf.html">How to adapt the script</a></p>
  </li>
  <li>
    <p><a href="https://docs.aws.amazon.com/general/latest/gr/sagemaker.html#limits_sagemaker">AWS Service quotas</a></p>
  </li>
  <li>
    <p><a href="https://github.com/aws/deep-learning-containers/blob/master/available_images.md">AWS Docker Containers for Machine Learning</a></p>
  </li>
</ul>

<p>Second, according to the documentation, if you want SageMaker to work with a custom learn algorithm, you’ll need to build and deploy your custom docker image. Yeah, “DevOps Plumber” trade union card of GTFO, this is how we do things in the world of enterprise-level cloud computing, right? Well, maybe I am too harsh. Actually, you can start a traning job from SageMaker Studio using an entrypoint that starts the custom algorythm. to use multiple source files, you need to use the source_dir argument when setting up the Estimator, and then put your code files in the directory you specify.</p>

<p>Minor caveat though: if your algorithm uses a dependency outside standard GNU/SciPi set, which is almost always the case for any audio-related, you cannot provide it with the training job. 
Techincally, you can install this dependency on your SageMaker Studio instance and run your code there. But guess what? Since training utilises almost all of the CPU, so, after 10 mins of no heartbeats, Amazon marks the instance as dead and shuts it down. Uskomaton!</p>

<p>Theoretically, the manual tells you, that you could use the standard <code class="highlighter-rouge">scipy</code> utilities for reading your audio files, if they stricly comply to 44.2Khz 16bit PCM standard. I tried that, with the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>f <span class="k">in</span> <span class="si">$(</span>find ./ <span class="nt">-name</span> <span class="s1">'*.wav'</span><span class="si">)</span><span class="p">;</span> <span class="k">do 
</span>ffmpeg <span class="nt">-i</span> <span class="nv">$f</span> <span class="nt">-acodec</span> pcm_s16le <span class="nt">-ar</span> 44100 <span class="k">${</span><span class="nv">f</span><span class="p">%.wav</span><span class="k">}</span>z.wav<span class="p">;</span> 
<span class="nb">rm</span> <span class="nv">$f</span><span class="p">;</span>
<span class="nb">mv</span> <span class="k">${</span><span class="nv">f</span><span class="p">%.wav</span><span class="k">}</span>z.wav <span class="nv">$f</span><span class="p">;</span>
<span class="k">done</span>
</code></pre></div></div>

<p>That did not work, as WaveGAN kept crashing over reading input files, so I refined steps of training a GAN to be:</p>
<ol>
  <li>Build and upload your custom image to Amazon ECR</li>
  <li>Upload raw material to S3</li>
  <li>Start a training job either through SageMaker UI or Python API.</li>
</ol>

<p>Notice how I’ve amended the “monitoring” step. I did it, because SageMaker’s proposed solution for monitoring is a freaking joke. Like downloading the checkpoints and examining them locally with Tensorboard? <strong>Bruuuuuuh</strong></p>

<p>Using this tutorial I was able to put together a modified version of the original tensorflow docker container which I made publicly available in this <a href="https://github.com/deviant-syndrome/wavegan-sagemaker">repo</a>. After a few 30 min feedback cycles, I was able to get it working.</p>

<p>This is where you’ll begin to realize that those “Free Tier” conditions are quite limiting. First and foremost, no GPU instances are included in free tier limits. Technically, TensorFlow supports calculation on XLA devices, and you would need to change the following in the initialisation code of WaveGAN <a href="https://github.com/chrisdonahue/wavegan/blob/master/loader.py#L193">here</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="s">'/device::XLA_CPU:{}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">prefetch_gpu_num</span><span class="p">)))</span>
</code></pre></div></div>

<p>Sweet, but it is still notebably slower than one would expect, I got about 720 steps overnight, versus about 2000 on a GPU instance. Maybe I should have been using the CPU version of the AWS Tensorflow image for that?<br />
And adversities with the GPU instances do not end on their cost. They are disabled in your AWS account by default and you have to contact AWS support to get access to them. AWS support service SLA is about 24 hours, which is quite alright for an enterprise like this, but could be a real show-stopper, when you have your creative juices flowing.</p>

<h4 id="what-was-left-behind">What was left behind</h4>

<p>I did not familiarize myself enough with the machine learning domain in general and Tensorflow framework specifically to take advantage of <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/distributed-training.html">SageMaker’s distributed learnning capabilities</a>.</p>

<p>Seems like WaveGAN output sample rates are quite low 16-22Khz depending on the output length. This means that we would have a very pronounced aliasing in the cymbals/percussion domain, and generally low sound fidelity.</p>

<p>For more rhythmic excitement and cohesiveness, I probably need longer slices (currently, maximum is 4 seconds at 16Khz)</p>

<p>It might be better to skip the AWS WebUI altogether and use boto3 library to run the code that deploys image and runs training locally.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">account</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">boto_session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">"sts"</span><span class="p">)</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()[</span><span class="s">"Account"</span><span class="p">]</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">boto_session</span><span class="o">.</span><span class="n">region_name</span>
<span class="n">image</span> <span class="o">=</span> <span class="s">"{}.dkr.ecr.{}.amazonaws.com/sagemaker-decision-trees:latest"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">sage</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">Estimator</span><span class="p">(</span>
    <span class="n">image</span><span class="p">,</span>
    <span class="n">role</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="s">"ml.c4.2xlarge"</span><span class="p">,</span>
    <span class="n">output_path</span><span class="o">=</span><span class="s">"s3://{}/output"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">default_bucket</span><span class="p">()),</span>
    <span class="n">sagemaker_session</span><span class="o">=</span><span class="n">sess</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_location</span><span class="p">)</span>
</code></pre></div></div>

<p>I am still not sure if I can provide clear instructions on setting up the AWS permissions for the whole setup. So, I’ll just leave a citation from AWS documentation here:</p>

<p>Running this notebook requires permissions in addition to the normal SageMakerFullAccess permissions. This is because we’ll creating new repositories in Amazon ECR. The easiest way to add these permissions is simply to add the managed policy AmazonEC2ContainerRegistryFullAccess to the role that you used to start your notebook instance. There’s no need to restart your notebook instance when you do this, the new permissions will be available immediately.</p>

<p>I used a very basic soloed drumkit from a drum lib demo for the input data. Next time I could try something more extreme like those isolated drum playthroughs: <a href="https://www.youtube.com/watch?v=7tw0l5l66N0">1</a>, <a href="https://www.youtube.com/watch?v=2fXAWK42na8">2</a>, <a href="https://www.youtube.com/watch?v=6nlcH_9Bbbk">3</a>, <a href="https://www.youtube.com/watch?v=mL-LyKcFE5c">4</a></p>

<p>Need to see, how WaveGAN is generating sample slices from the source audio. Need to see the number of slices and 
how they are affecting the number of training epochs. The number of steps recommended in the manual is 200K. 
For that matter I would maybe need to extract the slicing logic into separate “analytical” code that would prompt me about the numer of steps/time needed.</p>

<h4 id="ps">P.S.</h4>

<p>If you ever wandered how to run docker on a machine without a network interface:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dockerd <span class="nt">--iptables</span><span class="o">=</span><span class="nb">false</span> <span class="nt">--bridge</span><span class="o">=</span>none
</code></pre></div></div>

  </section>
  
</article>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2022 Deviant Syndrome. All rights reserved.</span>
  <span class="footer__copyright">Based on <a href="https://github.com/joshgerdes/jekyll-uno">jekyll-uno</a> theme by Josh Gerdes</span>
</footer>

<script type="text/javascript" src="/js/main.js?1661589250310431000"></script>
<script type="text/javascript" src="/js/sheetrender.js"></script>
<script src="/js/audioplaylist.js"></script>	


    </div>
  </body>
</html>
